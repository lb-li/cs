<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
  <title>购物网站</title>
</head>
<body>
  <div id="app">
    <h1>购物网站</h1>
    <button id="loginBtn" style="display: none;">登录</button>
    <div id="userInfo" style="display: none;">欢迎您，<span id="username"></span></div>
  </div><script data-cfasync="false">
    // 检测是否在App环境中
    function isInApp() {
      return typeof window.AppSDK !== 'undefined';
    }

    // 页面加载完成
    document.addEventListener('DOMContentLoaded', function() {
      const loginBtn = document.getElementById('loginBtn');
      const userInfo = document.getElementById('userInfo');
      
      // 检查登录状态
      const token = localStorage.getItem('token');
      if (token) {
        userInfo.style.display = 'block';
        document.getElementById('username').innerText = localStorage.getItem('username') || '用户';
      } else {
        loginBtn.style.display = 'block';
      }
      
      // 监听 SDK 加载完成
      document.addEventListener('AppSDKReady', function() {
        console.log('App SDK 已加载');
        // 绑定登录按钮点击事件
        loginBtn.addEventListener('click', function() {
          if (isInApp()) {
            // 在 App 内，调用 SDK 打开登录页面
            window.AppSDK.openLogin();
            // 设置登录成功的回调
            window.AppSDK.setLoginCallback(function(data) {
              console.log('登录成功', data);
              // 存储 token
              localStorage.setItem('token', data.token);
              if (data.userInfo) {
                localStorage.setItem('username', data.userInfo.username);
                document.getElementById('username').innerText = data.userInfo.username;
              }
              // 更新 UI
              loginBtn.style.display = 'none';
              userInfo.style.display = 'block';
            });
          } else {
            // 不在 App 内，跳转到普通登录页面
            window.location.href = '/login.html';
          }
        });
      });
    });
  </script>
</body>
</html>
