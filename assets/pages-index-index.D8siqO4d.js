import{_ as o,s as a,a as t,n as e,b as s,r as l,c as i,w as n,i as r,o as d,d as c,e as p,f as u,F as g,g as h,h as m,j as f,k as w,t as A}from"./index-CXYRgNF1.js";import{P as k,r as y}from"./page-loading.wY0R-w2q.js";import{P as C}from"./product-card.BnZqshTk.js";const b=o({components:{ProductCard:C,PageLoading:k},data:()=>({keyword:"",banners:[],categoryNav:[{name:"女装",icon:"woman",color:"#ff4d4f",id:1},{name:"男装",icon:"man",color:"#1890ff",id:2},{name:"鞋包",icon:"bag",color:"#faad14",id:3},{name:"数码",icon:"phone",color:"#52c41a",id:4},{name:"家电",icon:"tv",color:"#722ed1",id:5},{name:"美妆",icon:"gift",color:"#eb2f96",id:6},{name:"母婴",icon:"baby",color:"#13c2c2",id:7},{name:"食品",icon:"food",color:"#fa8c16",id:8}],productList:[],page:1,loadStatus:"loadmore",isLoading:!0,scrollTop:0}),onLoad(){console.log("AppBridge是否存在:",!!window.AppBridge),window.AppBridge&&console.log("AppBridge.isInApp:",window.AppBridge.isInApp),this.loadData()},onPullDownRefresh(){this.refreshData()},onReachBottom(){this.loadMore()},onPageScroll(o){this.scrollTop=o.scrollTop},methods:{testAppCommunication(){if(console.log("测试与App通信"),window.AppBridge&&window.AppBridge.isInApp){console.log("在App环境中，发送消息");const o=window.AppBridge.requestLogin();a(o?{title:"消息已发送",icon:"none"}:{title:"消息发送失败",icon:"none"})}else console.log("不在App环境中"),a({title:"不在App环境中",icon:"none"})},async loadData(){try{const o=await y({url:"/banners"});this.banners=o||[];const a=await y({url:"/categories"});this.categoryNav=(a||[]).slice(0,8);const e=await y({url:"/products"});this.productList=e||[],this.loadStatus=this.productList.length<6?"nomore":"loadmore"}catch(o){console.error("加载数据失败",o),a({title:"加载数据失败",icon:"none"}),this.loadStatus="nomore"}finally{this.isLoading=!1,t()}},refreshData(){this.page=1,this.loadData()},loadMore(){"loadmore"===this.loadStatus&&(this.loadStatus="loading",setTimeout((()=>{if(this.page<3){const o=this.productList.slice(0,3).map((o=>({...o,id:o.id+this.productList.length})));this.productList=[...this.productList,...o],this.page++,this.loadStatus="loadmore"}else this.loadStatus="nomore"}),1e3))},goToSearch(){e({url:"/pages/search/index"})},goToCategory(o){s({url:`/pages/category/index?id=${o.id}`})},handleBannerClick(o){const a=this.banners[o];a&&a.url&&e({url:a.url})},handleAddToCart(o){console.log("添加到购物车",o)}}},[["render",function(o,a,t,e,s,k){const y=l("u-search"),C=r,b=l("u-swiper"),_=l("u-icon"),L=f,T=l("u-grid-item"),B=l("u-grid"),S=l("product-card"),x=w,v=l("u-loadmore"),D=l("page-loading"),P=l("u-back-top"),j=l("u-toast");return d(),i(C,{class:"container"},{default:n((()=>[c(C,{class:"search-box"},{default:n((()=>[c(y,{placeholder:"搜索商品",modelValue:s.keyword,"onUpdate:modelValue":a[0]||(a[0]=o=>s.keyword=o),"show-action":!1,onClick:k.goToSearch,disabled:""},null,8,["modelValue","onClick"])])),_:1}),c(C,{class:"swiper-box"},{default:n((()=>[c(b,{list:s.banners,keyName:"image",height:350,radius:10,interval:3e3,onClick:k.handleBannerClick},null,8,["list","onClick"])])),_:1}),c(C,{class:"category-nav"},{default:n((()=>[c(B,{col:4,border:!1},{default:n((()=>[(d(!0),p(g,null,u(s.categoryNav,((o,a)=>(d(),i(T,{key:a,onClick:a=>k.goToCategory(o)},{default:n((()=>[c(_,{name:o.icon,size:"60rpx",color:o.color},null,8,["name","color"]),c(L,{class:"grid-text"},{default:n((()=>[h(A(o.name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),c(C,{class:"section-title"},{default:n((()=>[c(L,null,{default:n((()=>[h("热门商品")])),_:1}),c(_,{name:"arrow-right",size:"28rpx",color:"#999"})])),_:1}),c(C,{class:"product-list"},{default:n((()=>[(d(!0),p(g,null,u(s.productList,((o,a)=>(d(),i(C,{class:"product-item",key:a},{default:n((()=>[c(S,{product:o,onAddToCart:k.handleAddToCart},null,8,["product","onAddToCart"])])),_:2},1024)))),128))])),_:1}),c(x,{class:"test-btn",onClick:k.testAppCommunication},{default:n((()=>[h("测试与App壳通信")])),_:1},8,["onClick"]),s.productList.length>0?(d(),i(C,{key:0,class:"load-more"},{default:n((()=>[c(v,{status:s.loadStatus,"icon-type":"flower","loading-text":"努力加载中"},null,8,["status"])])),_:1})):m("",!0),c(D,{show:s.isLoading},null,8,["show"]),c(P,{"scroll-top":s.scrollTop},null,8,["scroll-top"]),c(j,{ref:"uToast"},null,512)])),_:1})}],["__scopeId","data-v-d74b7d46"]]);export{b as default};
